<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LukStore Bazar</title>

<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

<style>
body{font-family:Segoe UI,sans-serif;background:#f0f2f5;margin:0}
.hidden{display:none}
button{cursor:pointer}

#telaInicial{
height:100vh;display:flex;flex-direction:column;
justify-content:center;align-items:center;
background:linear-gradient(135deg,#2563eb,#7c3aed);
color:#fff;text-align:center
}
#telaInicial button{
padding:16px 32px;border:none;border-radius:16px;
font-size:18px;margin:10px;background:#fff;color:#2563eb;font-weight:bold
}

.box{
background:#fff;padding:25px;border-radius:18px;
max-width:520px;margin:20px auto;
box-shadow:0 10px 30px rgba(0,0,0,.15)
}

input,textarea{
width:100%;padding:12px;margin:6px 0;
border-radius:12px;border:1px solid #ddd
}

.cards{
display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));
gap:20px;margin:20px
}

.card{
background:#fff;border-radius:16px;
box-shadow:0 6px 16px rgba(0,0,0,.15);
overflow:hidden;position:relative
}

.card img{
width:100%;height:200px;object-fit:cover
}

.card .info{padding:14px}
.preco{color:#16a34a;font-weight:bold}

.btnDelete{
position:absolute;top:10px;right:10px;
background:red;color:#fff;width:30px;height:30px;
border-radius:50%;display:flex;
align-items:center;justify-content:center;font-weight:bold;cursor:pointer;
z-index:10;
}

.contato{
background:#22c55e;color:#fff;
padding:10px;border-radius:12px;
text-align:center;margin-top:8px;
display:block;text-decoration:none;font-weight:bold
}

.verVendedor{
background:#3b82f6;color:#fff;
padding:8px;border-radius:12px;
text-align:center;margin-top:6px;
display:block;text-decoration:none;font-size:14px
}

#painelBtn{
position:fixed;bottom:20px;right:20px;
background:#7c3aed;color:#fff;
padding:14px 20px;border-radius:18px;
display:none;font-weight:bold;
box-shadow:0 6px 16px rgba(0,0,0,.25)
}
</style>
</head>

<body>

<div id="telaInicial">
<h1>LukStore Bazar</h1>
<p>Você quer ser Vendedor ou Comprador?</p>
<button onclick="entrarVendedor()">Vendedor</button>
<button onclick="entrarComprador()">Comprador</button>
</div>

<main id="main" class="hidden">

<section id="home" class="hidden">
<h3 style="text-align:center">Produtos</h3>
<div class="cards" id="listaProdutos"></div>
</section>

<section id="pagamento" class="hidden">
<div class="box">
<h3>Ativar painel vendedor</h3>
<p><b>PIX:</b> dd1825ef-9839-4b1e-a525-33cd66c6507a</p>
<p><b>Enviar comprovante para:</b> 5541997312887</p>
<p><b>Valor:</b> R$ 10,00</p>

<input id="codigo" placeholder="Código recebido">
<input id="nomeVendedor" placeholder="Seu nome">
<input id="whatsapp" placeholder="WhatsApp (DDD + número)">

<button onclick="ativarPainel()">Ativar acesso</button>
<p id="msg" style="color:red;font-weight:bold"></p>
</div>
</section>

<section id="painel" class="hidden">
<div class="box">
<h3>Criar produto</h3>
<input id="pNome" placeholder="Nome do produto">
<input id="pPreco" placeholder="Preço">
<textarea id="pDesc" placeholder="Descrição"></textarea>
<input type="file" id="pFoto">
<div style="display:flex;gap:10px;margin-top:6px;">
<button onclick="publicar()">Publicar produto</button>
<button onclick="abrirMeus()">Ver seus produtos</button>
</div>
</div>
</section>

<section id="meus" class="hidden">
<div class="box">
<h3>Meus anúncios</h3>
<div class="cards" id="listaMeus"></div>
</div>
</section>

<section id="vendedorProdutos" class="hidden">
<h3 style="text-align:center">Produtos do vendedor</h3>
<div class="cards" id="listaVendedor"></div>
</section>

</main>

<button id="painelBtn" onclick="abrirPainel()">Painel Vendedor</button>

<script>
const firebaseConfig={
apiKey:"AIzaSyA6NR4-nA1MBIy1STy_VRvwBpMRbezOU1s",
authDomain:"lukstore-bazar.firebaseapp.com",
projectId:"lukstore-bazar"
}
firebase.initializeApp(firebaseConfig)
const db=firebase.firestore()

let vendedor={}

// --- Verifica login automático ---
if(localStorage.getItem('vendedor')){
  const v=JSON.parse(localStorage.getItem('vendedor'))
  // Verifica validade: 30 dias
  if(Date.now() - v.data < 30*24*60*60*1000){
    vendedor=v
    painelBtn.style.display='block'
    document.getElementById('telaInicial').classList.add('hidden')
    document.getElementById('main').classList.remove('hidden')
    mostrar('home')
    carregarProdutos()
  }else{
    localStorage.removeItem('vendedor')
  }
}

function mostrar(id){
document.querySelectorAll('main section').forEach(s=>s.classList.add('hidden'))
document.getElementById(id).classList.remove('hidden')
}

function entrarComprador(){
document.getElementById('telaInicial').classList.add('hidden')
document.getElementById('main').classList.remove('hidden')
mostrar('home')
carregarProdutos()
}

function entrarVendedor(){
document.getElementById('telaInicial').classList.add('hidden')
document.getElementById('main').classList.remove('hidden')
mostrar('pagamento')
}

function ativarPainel(){
const cod=codigo.value.trim()
const ultimo=cod.slice(-1)
if(cod.length!==6 || !['1','2','4','5','9'].includes(ultimo)){
  msg.innerText='Código inválido!'
  return
}
if(!nomeVendedor.value || !whatsapp.value){
  msg.innerText='Preencha todos os campos!'
  return
}

vendedor={
nome:nomeVendedor.value,
whatsapp:whatsapp.value,
data:Date.now()
}
localStorage.setItem('vendedor',JSON.stringify(vendedor))
painelBtn.style.display='block'
msg.innerText=''
mostrar('home')
carregarProdutos()
}

function abrirPainel(){
pNome.value='';pPreco.value='';pDesc.value='';pFoto.value=''
mostrar('painel')
}

function publicar(){
const file=pFoto.files[0]
if(!pNome.value || !pPreco.value){
  alert('Preencha nome e preço!')
  return
}
if(file){
  const r=new FileReader()
  r.onload=e=>salvar(e.target.result)
  r.readAsDataURL(file)
}else salvar('')
}

function salvar(img){
db.collection('produtos').add({
nome:pNome.value,
preco:pPreco.value,
desc:pDesc.value,
foto:img,
vendedor:vendedor.nome,
whatsapp:vendedor.whatsapp
}).then(()=>{
// Após publicar, limpa formulário e esconde tela de criar produto
pNome.value='';pPreco.value='';pDesc.value='';pFoto.value=''
mostrar('home')
abrirMeus()
})
}

function carregarProdutos(){
db.collection('produtos').onSnapshot(snap=>{
listaProdutos.innerHTML=''
snap.forEach(doc=>{
const p=doc.data()
listaProdutos.innerHTML+=`
<div class="card">
${p.foto?`<img src="${p.foto}">`:''}
<div class="info">
<h4>${p.nome}</h4>
<div class="preco">R$ ${p.preco}</div>
<div>${p.vendedor}</div>
<a class="verVendedor" onclick="verVendedor('${p.whatsapp}')">Ver produtos desse vendedor</a>
<a class="contato" target="_blank" href="https://wa.me/55${p.whatsapp}">Entrar em contato</a>
</div>
</div>`
})
})
}

function verVendedor(w){
mostrar('vendedorProdutos')
db.collection('produtos').where('whatsapp','==',w)
.onSnapshot(snap=>{
listaVendedor.innerHTML=''
snap.forEach(doc=>{
const p=doc.data()
listaVendedor.innerHTML+=`
<div class="card">
${p.foto?`<img src="${p.foto}">`:''}
<div class="info">
<h4>${p.nome}</h4>
<div class="preco">R$ ${p.preco}</div>
<a class="contato" target="_blank" href="https://wa.me/55${p.whatsapp}">Entrar em contato</a>
</div>
</div>`
})
})
}

function abrirMeus(){
db.collection('produtos')
.where('whatsapp','==',vendedor.whatsapp)
.onSnapshot(snap=>{
listaMeus.innerHTML=''
snap.forEach(doc=>{
const p=doc.data()
listaMeus.innerHTML+=`
<div class="card">
<div class="btnDelete" onclick="db.collection('produtos').doc('${doc.id}').delete()">X</div>
${p.foto?`<img src="${p.foto}">`:''}
<div class="info">
<h4>${p.nome}</h4>
<div class="preco">R$ ${p.preco}</div>
</div>
</div>`
})
})
}
</script>

</body>
</html>
